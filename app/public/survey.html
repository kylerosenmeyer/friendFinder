<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>FF Survey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--CSS Resources-->
    <link rel="stylesheet" type="text/css" href="reset.css"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <link href="https://fonts.googleapis.com/css?family=Acme|Dancing+Script|Spicy+Rice" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">

</head>
<body>
    
    <div class="container">
        <form>
            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Name (Required)</h2>
                    <input type="text" class="form-control" name="inputName" id="inputName" placeholder="Clark Kent">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Photo (Required)</h2>
                    <input type="url" class="form-control" name="inputPhoto" id="inputPhoto" placeholder="Paste URL Here">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>How often do you like being spontaneous?</h2>
                    <p id="q1percent"></p>
                    <p>Less</p><input type="range" class="form-control" name="inputQ1" id="inputQ1" placeholder="Q1"><p>More</p>
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ2" id="inputQ2" placeholder="Q2">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ3" id="inputQ3" placeholder="Q3">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ4" id="inputQ4" placeholder="Q4">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ5" id="inputQ5" placeholder="Q5">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ6" id="inputQ6" placeholder="Q6">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ7" id="inputQ7" placeholder="Q7">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ8" id="inputQ8" placeholder="Q8">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ9" id="inputQ9" placeholder="Q9">
                </div>
            </div>

            <div class="form-group row">
                <label for="inputName" class="col-sm-1-12 col-form-label"></label>
                <div class="col-sm-1-12">
                    <h2>Question 1</h2>
                    <input type="range" class="form-control" name="inputQ10" id="inputQ10" placeholder="Q10">
                </div>
            </div>
           
            <div class="form-group row">
                <div class="offset-sm-2 col-sm-10">
                    <button type="button" class="btn btn-primary" id="submitSurvey">Find Your Match</button>
                </div>
            </div>
        </form>
    </div>

    <div class="modal fade" id="perfectMatchModal" tabindex="-1" role="dialog" aria-labelledby="perfectMatchModal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="perfectMatchModal">We Found Your Perfect Friend.</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h2 id="matchName"></h2>
                        <img id="matchPhoto" src="">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="nextFriend">Find a New Friend</button>
                    </div>
                </div>
            </div>
        </div>

    <!--JS Resources-->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"></script>

    <!--In Line jQuery used to handle the submit click event and hit the POST route in apiRoutes.js-->
    <script>
        
        //The submitSurvey event grabs all the data from the user's entry, posts it to /api/friends for processing, and grabs the resulting match.
        $("#submitSurvey").click( function(event) {

            //Prevent the page from refreshing.
            event.preventDefault()
            
            //Grab the input data.
            let name = $("#inputName").val().trim(),
                photo = $("#inputPhoto").val().trim(),
                q1 = $("#inputQ1").val(),
                q2 = $("#inputQ2").val(),
                q3 = $("#inputQ3").val(),
                q4 = $("#inputQ4").val(),
                q5 = $("#inputQ5").val(),
                q6 = $("#inputQ6").val(),
                q7 = $("#inputQ7").val(),
                q8 = $("#inputQ8").val(),
                q9 = $("#inputQ9").val(),
                q10 = $("#inputQ10").val()

            let newScore = []
            //Store the score data in an array.
            newScore.push(q1,q2,q3,q4,q5,q6,q7,q8,q9,q10)
            
            //Create the newFriend object to be sent to the server.
            let newFriend = {
                name: name,
                photo: photo,
                score: newScore
            }

            // console.log("This is your profile: \n", newFriend)
            
            //POST the newFriend object to /api/friends.
            $.post("/api/friends", newFriend)
                .then( function() {
                    // console.log("Profile Add to the Friend Finder!")
                })
            
            //In between these two AJAX calls, apiRoutes is handeling all the processings.
                
            //after 1 second, grab the resulting match from api/friends.
            setTimeout( function() {
                
                $.get("/api/friends", function(data) {

                    console.log(data)
                    let perfectFriend = data.pFriend[0]
                    if ( perfectFriend.name !== "" ) {

                        //Attach the information to id's on this page, and trigger the modal.
                        $("#matchName").text(perfectFriend.perfectName)
                        $("#matchPhoto").attr("src", perfectFriend.perfectPhoto)
                        $("#perfectMatchModal").modal("toggle")
                    }
                })
            },1000)
            
        })

        //When the modal is triggered, focus on it.
        $('#perfectMatchModal').on('show.bs.modal', function() {
            $("#perfectMatchModal").trigger("focus")
        })

    </script>
</body>
</html>